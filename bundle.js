/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={1016(e,t,n){n.d(t,{A:()=>Je});var r=n(1601),o=n.n(r),a=n(6314),i=n.n(a),c=n(4417),l=n.n(c),s=new URL(n(7935),n.b),u=new URL(n(1409),n.b),f=new URL(n(3232),n.b),p=new URL(n(1265),n.b),h=new URL(n(6267),n.b),m=new URL(n(186),n.b),d=new URL(n(9745),n.b),y=new URL(n(8490),n.b),b=new URL(n(2573),n.b),v=new URL(n(4496),n.b),g=new URL(n(8956),n.b),w=new URL(n(9221),n.b),S=new URL(n(6092),n.b),k=new URL(n(4184),n.b),P=new URL(n(5513),n.b),C=new URL(n(3062),n.b),x=new URL(n(4875),n.b),O=new URL(n(5134),n.b),E=new URL(n(7335),n.b),L=new URL(n(6153),n.b),j=new URL(n(9e3),n.b),T=new URL(n(9593),n.b),M=new URL(n(5523),n.b),A=new URL(n(7986),n.b),G=new URL(n(4041),n.b),U=new URL(n(7538),n.b),R=new URL(n(1605),n.b),_=new URL(n(6318),n.b),$=new URL(n(3933),n.b),z=new URL(n(6291),n.b),B=new URL(n(9702),n.b),I=new URL(n(1906),n.b),N=new URL(n(4347),n.b),D=new URL(n(1216),n.b),F=new URL(n(4437),n.b),J=new URL(n(3160),n.b),q=new URL(n(8341),n.b),H=new URL(n(2076),n.b),X=new URL(n(3860),n.b),Q=new URL(n(6943),n.b),W=new URL(n(6168),n.b),K=new URL(n(227),n.b),V=new URL(n(756),n.b),Y=new URL(n(9334),n.b),Z=i()(o()),ee=l()(s),te=l()(u),ne=l()(f),re=l()(p),oe=l()(h),ae=l()(m),ie=l()(d),ce=l()(y),le=l()(b),se=l()(v),ue=l()(g),fe=l()(w),pe=l()(S),he=l()(k),me=l()(P),de=l()(C),ye=l()(x),be=l()(O),ve=l()(E),ge=l()(L),we=l()(j),Se=l()(T),ke=l()(M),Pe=l()(A),Ce=l()(G),xe=l()(U),Oe=l()(R),Ee=l()(_),Le=l()($),je=l()(z),Te=l()(B),Me=l()(I),Ae=l()(N),Ge=l()(D),Ue=l()(F),Re=l()(J),_e=l()(q),$e=l()(H),ze=l()(X),Be=l()(Q),Ie=l()(W),Ne=l()(K),De=l()(V),Fe=l()(Y);Z.push([e.id,`:root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url(${ee});\n  --map-tile-top-url: url(${te});\n  --map-tile-top-right-url: url(${ne});\n  --map-tile-bottom-left-url: url(${re});\n  --map-tile-bottom-url: url(${oe});\n  --map-tile-bottom-right-url: url(${ae});\n  --map-tile-left-url: url(${ie});\n  --map-tile-right-url: url(${ce});\n  --map-tile-center-url: url(${le});\n}\n\n.board.desert {\n  --map-tile-top-left-url: url(${se});\n  --map-tile-top-url: url(${ue});\n  --map-tile-top-right-url: url(${fe});\n  --map-tile-bottom-left-url: url(${pe});\n  --map-tile-bottom-url: url(${he});\n  --map-tile-bottom-right-url: url(${me});\n  --map-tile-left-url: url(${de});\n  --map-tile-right-url: url(${ye});\n  --map-tile-center-url: url(${be});\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url(${ve});\n  --map-tile-top-url: url(${ge});\n  --map-tile-top-right-url: url(${we});\n  --map-tile-bottom-left-url: url(${Se});\n  --map-tile-bottom-url: url(${ke});\n  --map-tile-bottom-right-url: url(${Pe});\n  --map-tile-left-url: url(${Ce});\n  --map-tile-right-url: url(${xe});\n  --map-tile-center-url: url(${Oe});\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url(${Ee});\n  --map-tile-top-url: url(${Le});\n  --map-tile-top-right-url: url(${je});\n  --map-tile-bottom-left-url: url(${Te});\n  --map-tile-bottom-url: url(${Me});\n  --map-tile-bottom-right-url: url(${Ae});\n  --map-tile-left-url: url(${Ge});\n  --map-tile-right-url: url(${Ue});\n  --map-tile-center-url: url(${Re});\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url(${_e});\n}\n\n.character.bowman {\n  background: url(${$e});\n}\n\n.character.daemon {\n  background: url(${ze});\n}\n\n.character.magician {\n  background: url(${Be});\n}\n\n.character.swordsman {\n  background: url(${Ie});\n}\n\n.character.undead {\n  background: url(${Ne});\n}\n\n.character.vampire {\n  background: url(${De});\n}\n\n.character.zombie {\n  background: url(${Fe});\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n/* Game Messages */\n.game-messages {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  z-index: 1000;\n  max-width: 300px;\n}\n\n.game-message {\n  background: rgba(0, 0, 0, 0.9);\n  color: #fff;\n  padding: 15px 20px;\n  margin-bottom: 10px;\n  border-radius: 8px;\n  border-left: 5px solid #fff;\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n  animation: slideIn 0.3s ease-out;\n  font-size: 14px;\n  line-height: 1.5;\n}\n\n.game-message-info {\n  border-left-color: #3498db;\n  background: rgba(52, 152, 219, 0.9);\n}\n\n.game-message-success {\n  border-left-color: #2ecc71;\n  background: rgba(46, 204, 113, 0.9);\n}\n\n.game-message-warning {\n  border-left-color: #f39c12;\n  background: rgba(243, 156, 18, 0.9);\n}\n\n.game-message-error {\n  border-left-color: #e74c3c;\n  background: rgba(231, 76, 60, 0.9);\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n/* Range Indicators */\n.range-indicator {\n  position: absolute;\n  pointer-events: none;\n  border: 2px dashed rgba(255, 255, 255, 0.5);\n  border-radius: 50%;\n  width: 64px;\n  height: 64px;\n  animation: pulse 2s infinite;\n}\n\n.range-indicator-move {\n  border-color: rgba(0, 255, 0, 0.5);\n}\n\n.range-indicator-attack {\n  border-color: rgba(255, 0, 0, 0.5);\n}\n\n@keyframes pulse {\n  0% {\n    transform: scale(1);\n    opacity: 0.8;\n  }\n  50% {\n    transform: scale(1.1);\n    opacity: 0.4;\n  }\n  100% {\n    transform: scale(1);\n    opacity: 0.8;\n  }\n}\n\n/* Score Display */\n.score-container {\n  position: fixed;\n  top: 20px;\n  left: 20px;\n  background: rgba(0, 0, 0, 0.8);\n  color: #fff;\n  padding: 15px 25px;\n  border-radius: 8px;\n  border: 2px solid #ffd700;\n  font-size: 18px;\n  font-weight: bold;\n  z-index: 1000;\n}\n\n.score-label {\n  color: #ffd700;\n  margin-right: 10px;\n}\n\n.score-value {\n  color: #fff;\n}\n\n.max-score {\n  color: #ff6b6b;\n  margin-left: 15px;\n}\n\n/* Game Modal */\n.game-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 2000;\n  animation: fadeIn 0.3s ease-out;\n}\n\n.game-modal-content {\n  background: #1a1a1a;\n  border: 2px solid #ffd700;\n  border-radius: 12px;\n  padding: 30px;\n  max-width: 400px;\n  text-align: center;\n  color: #fff;\n  box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);\n}\n\n.game-modal-content p {\n  font-size: 18px;\n  margin-bottom: 25px;\n  line-height: 1.5;\n}\n\n.game-modal-buttons {\n  display: flex;\n  justify-content: center;\n  gap: 20px;\n}\n\n.game-modal-buttons .btn {\n  padding: 10px 30px;\n  font-size: 16px;\n  cursor: pointer;\n  border: none;\n  border-radius: 6px;\n  transition: all 0.3s;\n}\n\n.game-modal-buttons .btn-yes {\n  background: #2ecc71;\n  color: #fff;\n}\n\n.game-modal-buttons .btn-yes:hover {\n  background: #27ae60;\n  transform: scale(1.05);\n}\n\n.game-modal-buttons .btn-no {\n  background: #e74c3c;\n  color: #fff;\n}\n\n.game-modal-buttons .btn-no:hover {\n  background: #c0392b;\n  transform: scale(1.05);\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n`,""]);const Je=Z},6314(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(i[l]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);r&&i[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},4417(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},1601(e){e.exports=function(e){return e[1]}},5072(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},i=[],c=0;c<e.length;c++){var l=e[c],s=r.base?l[0]+r.base:l[0],u=a[s]||0,f="".concat(s," ").concat(u);a[s]=u+1;var p=n(f),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var m=o(h,r);r.byIndex=c,t.splice(c,0,{identifier:f,updater:m,references:1})}i.push(f)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=n(a[i]);t[c].references--}for(var l=r(e,o),s=0;s<a.length;s++){var u=n(a[s]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}a=l}}},7659(e){var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},9593(e,t,n){e.exports=n.p+"b27323cf850ed820855c.png"},7986(e,t,n){e.exports=n.p+"ac9d74f57639792774bc.png"},5523(e,t,n){e.exports=n.p+"63aae58e4690953a3857.png"},1605(e,t,n){e.exports=n.p+"246277b8ca590816b3e8.png"},4041(e,t,n){e.exports=n.p+"3d9503e0a850fda86f82.png"},7538(e,t,n){e.exports=n.p+"22e7c5ede3f747cbe27a.png"},7335(e,t,n){e.exports=n.p+"eab6a2cc5e89a4dd8e3f.png"},9e3(e,t,n){e.exports=n.p+"d31d84c693f649766aee.png"},6153(e,t,n){e.exports=n.p+"e0aa3daf6d08c62c96d9.png"},2076(e,t,n){e.exports=n.p+"cec542854b228e61547a.png"},3860(e,t,n){e.exports=n.p+"cf170a9fea1051b7424a.png"},8341(e,t,n){e.exports=n.p+"0a77fc47d727eab6fd39.png"},6943(e,t,n){e.exports=n.p+"c0fa2b75539f94144dc4.png"},6168(e,t,n){e.exports=n.p+"2007ec00c1d9f997e704.png"},227(e,t,n){e.exports=n.p+"f5c75398bcb5931f9f3c.png"},756(e,t,n){e.exports=n.p+"bf0ed0dca1d1e6091d42.png"},9334(e,t,n){e.exports=n.p+"296dfeac15e2377fc1dc.png"},6092(e,t,n){e.exports=n.p+"13edb269e39172ddd74f.png"},5513(e,t,n){e.exports=n.p+"5cf9c17d6a1ea7106a6c.png"},4184(e,t,n){e.exports=n.p+"f1703771380a9959d979.png"},5134(e,t,n){e.exports=n.p+"51e2a5de56bd631452fe.png"},3062(e,t,n){e.exports=n.p+"eb1f6e4f87b977012684.png"},4875(e,t,n){e.exports=n.p+"2c19971f327b288278bb.png"},4496(e,t,n){e.exports=n.p+"258d884122fabfc2f312.png"},9221(e,t,n){e.exports=n.p+"2f1e1970c2c20cf3a8d5.png"},8956(e,t,n){e.exports=n.p+"dc3f97e7bbcd5ea1ded9.png"},9702(e,t,n){e.exports=n.p+"1d70f1dab2dd418c3612.png"},4347(e,t,n){e.exports=n.p+"6bacb8e25ed9ecf726bf.png"},1906(e,t,n){e.exports=n.p+"f462d2ed6eedca1e4fd9.png"},3160(e,t,n){e.exports=n.p+"6f6f7c09bde970b2e41b.png"},1216(e,t,n){e.exports=n.p+"c75f062dddba6e98fdc6.png"},4437(e,t,n){e.exports=n.p+"26fdc25019c24e87f11a.png"},6318(e,t,n){e.exports=n.p+"ef1b0ea8c4e545d9aadc.png"},6291(e,t,n){e.exports=n.p+"a1d2321024649b9d8f5f.png"},3933(e,t,n){e.exports=n.p+"8b928c3eb136543e573a.png"},1265(e,t,n){e.exports=n.p+"26b5f224d8750119922d.png"},186(e,t,n){e.exports=n.p+"2429af6d3a5796e3c34b.png"},6267(e,t,n){e.exports=n.p+"07d5e8127645225478b6.png"},2573(e,t,n){e.exports=n.p+"0089a610e6611f679b50.png"},9745(e,t,n){e.exports=n.p+"546abb060a0837550fd1.png"},8490(e,t,n){e.exports=n.p+"6a84ae91f5d985ddc9ee.png"},7935(e,t,n){e.exports=n.p+"46d63299c3420c030b4e.png"},3232(e,t,n){e.exports=n.p+"0ac7f8258ec7166dc957.png"},1409(e,t,n){e.exports=n.p+"946aeb948db6313f1d85.png"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,n.nc=void 0;var r=n(5072),o=n.n(r),a=n(7825),i=n.n(a),c=n(7659),l=n.n(c),s=n(5056),u=n.n(s),f=n(540),p=n.n(f),h=n(1113),m=n.n(h),d=n(1016),y={};function b(e,t){return e<t?0===e?"top-left":e===t-1?"top-right":"top":e>=t*(t-1)?e===t*(t-1)?"bottom-left":e===t*t-1?"bottom-right":"bottom":e%t===0?"left":e%t===t-1?"right":"center"}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=Math.floor(e/n),o=e%n,a=Math.floor(t/n),i=t%n;return Math.max(Math.abs(r-a),Math.abs(o-i))}function g(e){switch(e){case"swordsman":case"undead":return 4;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 1;default:return 0}}function w(e){switch(e){case"swordsman":case"undead":return 1;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 4;default:return 0}}function S(e,t,n){return v(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:8)<=w(n)}function k(e,t){return Math.max(e.attack-t.defence,.1*e.attack)}function P(e){return e.health<=0}function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,E(r.key),r)}}function E(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}y.styleTagTransform=m(),y.setAttributes=u(),y.insert=l().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=p(),o()(d.A,y),d.A&&d.A.locals&&d.A.locals;var L=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[],this.messageContainer=null},t=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(e){var t=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",function(e){return t.onNewGameClick(e)}),this.saveGameEl.addEventListener("click",function(e){return t.onSaveGameClick(e)}),this.loadGameEl.addEventListener("click",function(e){return t.onLoadGameClick(e)}),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var n=0;n<Math.pow(this.boardSize,2);n+=1){var r=document.createElement("div"),o=b(n,this.boardSize);r.classList.add("cell","map-tile","map-tile-".concat(o)),r.addEventListener("mouseenter",function(e){return t.onCellEnter(e)}),r.addEventListener("mouseleave",function(e){return t.onCellLeave(e)}),r.addEventListener("click",function(e){return t.onCellClick(e)}),this.boardEl.appendChild(r)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(e){var t=this;this.cells.forEach(function(e){e.innerHTML=""}),e.forEach(function(e){var n=t.boardEl.children[e.position],r=document.createElement("div");r.classList.add("character",e.character.type);var o=document.createElement("div");o.classList.add("health-level");var a,i=document.createElement("div"),c=(a=e.character.health)<15?"critical":a<50?"normal":"high";i.classList.add("health-level-indicator","health-level-indicator-".concat(c)),i.style.width="".concat(e.character.health,"%"),o.appendChild(i),r.appendChild(o),n.appendChild(r)})}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListeners.push(e)}},{key:"addSaveGameListener",value:function(e){this.saveGameListeners.push(e)}},{key:"addLoadGameListener",value:function(e){this.loadGameListeners.push(e)}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach(function(e){return e.call(null,t)})}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach(function(e){return e.call(null,t)})}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach(function(e){return e.call(null,t)})}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListeners.forEach(function(e){return e.call(null)})}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListeners.forEach(function(e){return e.call(null)})}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListeners.forEach(function(e){return e.call(null)})}},{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,n=this.cells[e];(t=n.classList).remove.apply(t,function(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(n.classList).filter(function(e){return e.startsWith("selected")})))}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var n=this;return new Promise(function(r){var o=n.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",function(){o.removeChild(a),r()})})}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],t&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,M(r.key),r)}}function M(e){var t=function(e){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:t+""}var A=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t},(t=[{key:"save",value:function(e){this.storage.setItem("state",JSON.stringify(e))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}])&&T(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function U(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$(r.key),r)}}function $(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}var z=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"performComputerTurn",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=[];return e.forEach(function(a){var i=n.findBestAttackAction(a,t,r);if(i)o.push(i);else{var c=n.findBestMoveAction(a,t,e,r);c&&o.push(c)}}),0===o.length?null:(o.sort(function(e,t){return"attack"===e.type&&"attack"!==t.type?-1:"attack"!==e.type&&"attack"===t.type?1:t.score-e.score}),o[0])}},{key:"findBestAttackAction",value:function(e,t,n){var r=this,o=e.position,a=e.character,i=null,c=-1/0;return t.forEach(function(t){if(S(o,t.position,a.type,n)){var l=r.calculateAttackScore(a,t.character);l>c&&(c=l,i={type:"attack",fromPosition:o,toPosition:t.position,score:l,attacker:e,target:t})}}),i}},{key:"calculateAttackScore",value:function(e,t){var n=0;return n+=(100-t.health)/100*50,k(e,t)>=t.health&&(n+=100),n+=this.getTypeAdvantageBonus(e.type,t.type),(n+=(100-t.defence)/100*20)+10*t.level}},{key:"getTypeAdvantageBonus",value:function(e,t){var n;return(null===(n={swordsman:{undead:30,daemon:20},bowman:{vampire:30,magician:20},magician:{daemon:40,undead:20,vampire:20},vampire:{magician:30,bowman:20},undead:{swordsman:30,bowman:20},daemon:{magician:40,bowman:20}}[e])||void 0===n?void 0:n[t])||0}},{key:"findBestMoveAction",value:function(e,t,n,r){var o=this;if(0===t.length)return null;var a=e.position,i=e.character,c=this.getPossibleMoves(a,i.type,[].concat(U(n),U(t)),r);if(0===c.length)return null;var l=null,s=-1/0,u=i.health,f=this.selectStrategy(i,u);return c.forEach(function(c){var u=o.evaluateMovePosition(i,a,c,t,n,f,r);u>s&&(s=u,l={type:"move",fromPosition:a,toPosition:c,score:u,character:e})}),s<=0?null:l}},{key:"getPossibleMoves",value:function(e,t,n,r){for(var o=[],a=g(t),i=Math.floor(e/r),c=e%r,l=i-a;l<=i+a;l++)for(var s=function(){if(l>=0&&l<r&&u>=0&&u<r){var t=l*r+u;if(t!==e){var i=n.some(function(e){return e.position===t}),c=v(e,t,r);!i&&c<=a&&o.push(t)}}},u=c-a;u<=c+a;u++)s();return o}},{key:"evaluateMovePosition",value:function(e,t,n,r,o,a,i){var c=this,l=0,s=r.filter(function(t){return S(n,t.position,e.type,i)});l+=50*s.length,s.forEach(function(t){var n=c.calculateAttackScore(e,t.character);l+=.5*n}),r.forEach(function(r){var o=v(t,r.position,i),c=v(n,r.position,i),s=w(e.type);"aggressive"===a?(c<o&&(l+=20),c<=s&&(l+=30)):"defensive"===a?c>o&&(l+=15):c<=s?l+=25:c<=s+1&&(l+=10)});var u=this.calculateDangerScore(n,r,e,i);l-=10*u;var f=this.calculateAllyBonus(n,o,i);return l+=f}},{key:"calculateDangerScore",value:function(e,t,n,r){var o=0;return t.forEach(function(t){var a=v(e,t.position,r),i=w(t.character.type);if(a<=i){var c=t.character.attack/10;o+=c*(i-a+1),k(t.character,n)>=n.health&&(o+=50)}}),o}},{key:"calculateAllyBonus",value:function(e,t,n){var r=0;return t.forEach(function(t){var o=v(e,t.position,n);1===o?r+=20:2===o&&(r+=10)}),r}},{key:"selectStrategy",value:function(e,t){return t<30?"defensive":"magician"===e.type||"daemon"===e.type?"strategic":"swordsman"===e.type||"undead"===e.type||Math.random()>.5?"aggressive":"strategic"}}],null&&_(e.prototype,null),t&&_(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),B=["prairie","desert","arctic","mountain"],I=function(e){return B[(e-1)%B.length]};function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,F(r.key),r)}}function F(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}var J=function(){return e=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"Character"===(this instanceof e?this.constructor:void 0).name)throw new Error("Cannot create instance of Character class directly");this.level=1,this.attack=0,this.defence=0,this.health=50,this.type=n},(t=[{key:"initStats",value:function(e,t){this.attack=e,this.defence=t}},{key:"levelUpTo",value:function(e){for(;this.level<e&&this.level<4;)this.levelUp()}},{key:"levelUp",value:function(){if(this.level+=1,this.level>4)this.level=4;else{this.health=Math.min(this.level+80,100);var e=(80+this.health)/100;this.attack=Math.max(this.attack,Math.floor(this.attack*e));var t=(80+this.health)/100;this.defence=Math.max(this.defence,Math.floor(this.defence*t))}}},{key:"isAlive",value:function(){return this.health>0}}])&&D(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(H=function(){return!!e})()}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}var W=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=X(t),function(e,t){if(t&&("object"==q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,H()?Reflect.construct(t,n||[],X(e).constructor):t.apply(e,n))}(this,t,[e,"bowman"])).initStats(25,25),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(V=function(){return!!e})()}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}var ee=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Y(t),function(e,t){if(t&&("object"==K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,V()?Reflect.construct(t,n||[],Y(e).constructor):t.apply(e,n))}(this,t,[e,"swordsman"])).initStats(40,10),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ne=function(){return!!e})()}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function oe(e,t){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oe(e,t)}var ae=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=re(t),function(e,t){if(t&&("object"==te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ne()?Reflect.construct(t,n||[],re(e).constructor):t.apply(e,n))}(this,t,[e,"magician"])).initStats(10,40),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ce=function(){return!!e})()}function le(e){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},le(e)}function se(e,t){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},se(e,t)}var ue=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=le(t),function(e,t){if(t&&("object"==ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ce()?Reflect.construct(t,n||[],le(e).constructor):t.apply(e,n))}(this,t,[e,"vampire"])).initStats(25,25),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&se(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function pe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(pe=function(){return!!e})()}function he(e){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},he(e)}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}var de=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=he(t),function(e,t){if(t&&("object"==fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,pe()?Reflect.construct(t,n||[],he(e).constructor):t.apply(e,n))}(this,t,[e,"undead"])).initStats(40,10),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(be=function(){return!!e})()}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ve(e)}function ge(e,t){return ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ge(e,t)}var we=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=ve(t),function(e,t){if(t&&("object"==ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,be()?Reflect.construct(t,n||[],ve(e).constructor):t.apply(e,n))}(this,t,[e,"daemon"])).initStats(10,10),e>1&&n.levelUpTo(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ge(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(J);function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pe(r.key),r)}}function Pe(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}var Ce=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=t},(t=[{key:"add",value:function(e){this.characters.push(e)}},{key:"remove",value:function(e){var t=this.characters.indexOf(e);-1!==t&&this.characters.splice(t,1)}},{key:"size",get:function(){return this.characters.length}},{key:Symbol.iterator,value:function(){var e=0,t=this.characters;return{next:function(){return e<t.length?{value:t[e++],done:!1}:{done:!0}}}}}])&&ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function xe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return Oe(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],f=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function h(n,r){for(c=n,l=r,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],h=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=n<2&&h<a[1])?(c=0,p.v=r,p.n=a[1]):h<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,m),c=u,l=m;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(p.n=-1),h(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Oe(t={},r,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Oe(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,Oe(f,"constructor",s),Oe(s,"constructor",l),l.displayName="GeneratorFunction",Oe(s,o,"GeneratorFunction"),Oe(f),Oe(f,o,"Generator"),Oe(f,r,function(){return this}),Oe(f,"toString",function(){return"[object Generator]"}),(xe=function(){return{w:a,m:p}})()}function Oe(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Oe=function(e,t,n,r){function a(t,n){Oe(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Oe(e,t,n,r)}var Ee=xe().m(Le);function Le(e,t){var n,r;return xe().w(function(o){for(;;)switch(o.n){case 0:return n=e[Math.floor(Math.random()*e.length)],r=Math.floor(Math.random()*t)+1,o.n=1,new n(r);case 1:o.n=0;break;case 2:return o.a(2)}},Ee)}function je(e,t,n){for(var r=Le(e,t),o=[],a=0;a<n;a++)o.push(r.next().value);return new Ce(o)}function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ge(r.key),r)}}function Ae(e,t,n){return t&&Me(e.prototype,t),n&&Me(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ge(e){var t=function(e){if("object"!=Te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Te(t)?t:t+""}var Ue=Ae(function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof J))throw new Error("character must be instance of Character or its children");if("number"!=typeof n)throw new Error("position must be a number");this.character=t,this.position=n});function Re(e){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(e)}function _e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,$e(r.key),r)}}function $e(e){var t=function(e){if("object"!=Re(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Re(t)?t:t+""}var ze=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"create",value:function(e,t){switch(e){case"bowman":return new W(t);case"swordsman":return new ee(t);case"magician":return new ae(t);case"vampire":return new ue(t);case"undead":return new de(t);case"daemon":return new we(t);default:throw new Error("Unknown character type: ".concat(e))}}},{key:"fromJSON",value:function(e){var t=this.create(e.type,e.level);return t.health=e.health,t.attack=e.attack,t.defence=e.defence,t}}],null&&_e(e.prototype,null),t&&_e(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Be(e){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Be(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ne(r.key),r)}}function Ne(e){var t=function(e){if("object"!=Be(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Be(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Be(t)?t:t+""}var De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=1,this.turn="player",this.score=0,this.maxScore=0,this.playerPositions=[],this.enemyPositions=[],this.currentTheme="prairie"}return t=e,r=[{key:"from",value:function(t){if(!t)return null;var n=new e;return n.level=t.level||1,n.turn=t.turn||"player",n.score=t.score||0,n.maxScore=t.maxScore||0,n.currentTheme=t.currentTheme||"prairie",n.playerPositions=(t.playerPositions||[]).map(function(e){var t=ze.fromJSON(e.character);return new Ue(t,e.position)}),n.enemyPositions=(t.enemyPositions||[]).map(function(e){var t=ze.fromJSON(e.character);return new Ue(t,e.position)}),n}}],(n=[{key:"toJSON",value:function(){return{level:this.level,turn:this.turn,score:this.score,maxScore:this.maxScore,playerPositions:this.playerPositions.map(function(e){return{character:{level:e.character.level,attack:e.character.attack,defence:e.character.defence,health:e.character.health,type:e.character.type},position:e.position}}),enemyPositions:this.enemyPositions.map(function(e){return{character:{level:e.character.level,attack:e.character.attack,defence:e.character.defence,health:e.character.health,type:e.character.type},position:e.position}}),currentTheme:this.currentTheme}}}])&&Ie(t.prototype,n),r&&Ie(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();const Fe="auto",Je="pointer",qe="crosshair",He="not-allowed";function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Qe(e){return function(e){if(Array.isArray(e))return We(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return We(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ve(r.key),r)}}function Ve(e){var t=function(e){if("object"!=Xe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xe(t)?t:t+""}var Ye=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.stateService=n,this.playerTeam=null,this.enemyTeam=null,this.playerPositions=[],this.enemyPositions=[],this.selectedCell=null,this.selectedCharacter=null,this.attackArea=[],this.moveArea=[],this.gameState=new De,this.isGameBlocked=!1},t=[{key:"init",value:function(){this.loadGame(),0===this.playerPositions.length?this.newGame():(this.gamePlay.drawUi(this.gameState.currentTheme),this.redraw()),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this))}},{key:"createTeams",value:function(){var e=[W,ee,ae],t=[ue,de,we];this.playerTeam=je(e,1,4),this.enemyTeam=je(t,1,4)}},{key:"positionTeams",value:function(){var e=this;this.playerPositions=[],this.enemyPositions=[];var t=[0,1],n=[6,7],r=0;this.playerTeam.characters.forEach(function(n){var o=8*Math.floor(r/2)+t[r%2];e.playerPositions.push(new Ue(n,o)),r++});var o=0;this.enemyTeam.characters.forEach(function(t){var r=8*Math.floor(o/2)+n[o%2];e.enemyPositions.push(new Ue(t,r)),o++})}},{key:"redraw",value:function(){var e=[].concat(Qe(this.playerPositions),Qe(this.enemyPositions));this.gamePlay.redrawPositions(e)}},{key:"getCharacterAtPosition",value:function(e){var t=this.playerPositions.find(function(t){return t.position===e});if(t)return{character:t.character,type:"player",positionedChar:t};var n=this.enemyPositions.find(function(t){return t.position===e});return n?{character:n.character,type:"enemy",positionedChar:n}:null}},{key:"isCellOccupied",value:function(e){return null!==this.getCharacterAtPosition(e)}},{key:"updateSelectedAreas",value:function(){if(!this.selectedCharacter||!this.selectedCell)return this.attackArea=[],void(this.moveArea=[]);this.attackArea=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=w(t),o=[],a=Math.floor(e/n),i=e%n,c=a-r;c<=a+r;c++)for(var l=i-r;l<=i+r;l++)if(c>=0&&c<n&&l>=0&&l<n){var s=c*n+l;v(e,s,n)<=r&&o.push(s)}return o}(this.selectedCell,this.selectedCharacter.type,8),this.moveArea=[];for(var e=0;e<64;e++)this.canMove(e)&&this.moveArea.push(e)}},{key:"onCellClick",value:function(e){if(this.isGameBlocked)this.gamePlay.showError(" .   .");else if("player"===this.gameState.turn){var t=this.getCharacterAtPosition(e);t?"player"===t.type?this.selectPlayerCharacter(e,t):this.selectedCharacter?this.attemptAttack(e):this.gamePlay.showError("   !"):this.selectedCharacter?this.attemptMove(e):this.deselectCharacter()}else this.gamePlay.showError("  !")}},{key:"selectPlayerCharacter",value:function(e,t){this.selectedCell===e?this.deselectCharacter():(null!==this.selectedCell&&this.gamePlay.deselectCell(this.selectedCell),this.selectedCell=e,this.selectedCharacter=t.character,this.gamePlay.selectCell(e,"yellow"),this.updateSelectedAreas())}},{key:"attemptAttack",value:function(e){this.canAttack(e)?this.performAttack(this.selectedCell,e):this.gamePlay.showError("   !")}},{key:"attemptMove",value:function(e){this.canMove(e)?this.performMove(this.selectedCell,e):this.gamePlay.showError("    !")}},{key:"deselectCharacter",value:function(){null!==this.selectedCell&&this.gamePlay.deselectCell(this.selectedCell),this.selectedCell=null,this.selectedCharacter=null,this.attackArea=[],this.moveArea=[]}},{key:"canMove",value:function(e){return!(!this.selectedCharacter||this.isCellOccupied(e))&&function(e,t,n){return v(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:8)<=g(n)}(this.selectedCell,e,this.selectedCharacter.type)}},{key:"canAttack",value:function(e){if(!this.selectedCharacter||!this.isCellOccupied(e))return!1;var t=this.getCharacterAtPosition(e);return!(!t||"player"===t.type)&&S(this.selectedCell,e,this.selectedCharacter.type)}},{key:"performMove",value:function(e,t){var n=this.getCharacterAtPosition(e);n&&(n.positionedChar.position=t,this.deselectCharacter(),this.redraw(),this.updateScore(),this.gameState.turn="computer",this.computerTurn())}},{key:"performAttack",value:function(e,t){var n=this,r=this.getCharacterAtPosition(e),o=this.getCharacterAtPosition(t);if(r&&o){var a=r.character,i=o.character,c=k(a,i);i.health-=c,P(i)&&(i.health=0,this.gameState.score+=10*i.level,this.gamePlay.showMessage("".concat(i.type," ! +").concat(10*i.level," ")),"enemy"===o.type?this.enemyPositions=this.enemyPositions.filter(function(e){return e.position!==t}):this.playerPositions=this.playerPositions.filter(function(e){return e.position!==t})),this.gamePlay.showDamage(t,Math.round(c)).then(function(){n.redraw(),n.deselectCharacter(),n.updateMaxScore(),n.checkGameEnd()||(n.gameState.turn="computer",n.computerTurn())})}}},{key:"updateScore",value:function(){this.gameState.score+=1}},{key:"updateMaxScore",value:function(){this.gameState.score>this.gameState.maxScore&&(this.gameState.maxScore=this.gameState.score,this.gamePlay.showMessage(" !  : ".concat(this.gameState.maxScore)))}},{key:"checkGameEnd",value:function(){return!!this.isGameBlocked||(0===this.playerPositions.length?(this.gameOver(""),!0):0===this.enemyPositions.length&&(this.gameState.level>=4?this.gameOver(""):this.levelUp(),!0))}},{key:"blockGame",value:function(){this.isGameBlocked=!0,this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this)),this.gamePlay.setCursor("default")}},{key:"gameOver",value:function(e){this.isGameBlocked=!0,this.blockGame(),this.updateMaxScore();var t="";t=""===e?" !     ".concat(this.gameState.level,"!"):"!   !",t+="\n: ".concat(this.gameState.score),t+="\n : ".concat(this.gameState.maxScore),t+="\n: ".concat(this.gameState.level),t+="\n : ".concat(Math.floor(this.gameState.score/10)),this.gamePlay.showMessage(t)}},{key:"levelUp",value:function(){this.gameState.level+=1;var e=50*this.gameState.level;this.gameState.score+=e,this.gamePlay.showMessage(" ".concat(this.gameState.level,"! : +").concat(e," ")),this.levelUpAllSurvivors(),this.updateTheme(),this.createEnemyTeamForLevel(),this.deselectCharacter(),this.gameState.turn="player"}},{key:"levelUpAllSurvivors",value:function(){this.playerPositions.forEach(function(e){e.character.levelUp()})}},{key:"updateTheme",value:function(){var e=I(this.gameState.level);this.gamePlay.drawUi(e),this.gameState.currentTheme=e}},{key:"createEnemyTeamForLevel",value:function(){var e=[ue,de,we],t=Math.floor(this.gameState.level/2),n=Math.min(3+t,8),r=Math.min(this.gameState.level,10);this.enemyTeam=je(e,r,n),this.positionTeams(),this.redraw()}},{key:"onCellEnter",value:function(e){var t,n,r,o,a,i=this.getCharacterAtPosition(e);if(i){var c=(n=(t=i.character).level,r=t.attack,o=t.defence,a=t.health,"".concat(n," ").concat(r," ").concat(o," ").concat(a));this.gamePlay.showCellTooltip(c,e),this.updateCursorForCell(e,i)}else this.gamePlay.hideCellTooltip(e),this.updateCursorForEmptyCell(e);this.highlightAreas(e)}},{key:"updateCursorForCell",value:function(e,t){"player"===t.type?this.gamePlay.setCursor(Je):this.selectedCharacter&&this.canAttack(e)?(this.gamePlay.setCursor(qe),this.gamePlay.selectCell(e,"red")):this.gamePlay.setCursor(He)}},{key:"updateCursorForEmptyCell",value:function(e){this.selectedCharacter?this.canMove(e)?(this.gamePlay.setCursor(Je),this.gamePlay.selectCell(e,"green")):this.gamePlay.setCursor(He):this.gamePlay.setCursor(Fe)}},{key:"highlightAreas",value:function(e){for(var t=this,n=0;n<64;n++)n!==this.selectedCell&&n!==e&&this.gamePlay.deselectCell(n);this.selectedCharacter&&(this.moveArea.forEach(function(n){n!==t.selectedCell&&n!==e&&t.gamePlay.selectCell(n,"green")}),this.attackArea.forEach(function(n){n!==t.selectedCell&&n!==e&&(t.moveArea.includes(n)||t.gamePlay.selectCell(n,"red"))}))}},{key:"onCellLeave",value:function(e){this.gamePlay.hideCellTooltip(e),e!==this.selectedCell&&this.gamePlay.deselectCell(e),this.gamePlay.setCursor(Fe)}},{key:"computerTurn",value:function(){var e=this;setTimeout(function(){var t=z.performComputerTurn(e.enemyPositions,e.playerPositions,8);t?"attack"===t.type?e.performComputerAttack(t.fromPosition,t.toPosition):"move"===t.type&&e.performComputerMove(t.fromPosition,t.toPosition):(e.gameState.turn="player",e.gamePlay.showMessage("  "))},1e3)}},{key:"performComputerMove",value:function(e,t){var n=this.getCharacterAtPosition(e);n&&(n.positionedChar.position=t,this.redraw(),this.gameState.turn="player")}},{key:"performComputerAttack",value:function(e,t){var n=this,r=this.getCharacterAtPosition(e),o=this.getCharacterAtPosition(t);if(r&&o){var a=r.character,i=o.character,c=k(a,i);i.health-=c,P(i)&&(i.health=0,this.playerPositions=this.playerPositions.filter(function(e){return e.position!==t}),this.gamePlay.showMessage(" ".concat(i.type," !"))),this.gamePlay.showDamage(t,Math.round(c)).then(function(){n.redraw(),n.checkGameEnd()||(n.gameState.turn="player")})}}},{key:"newGame",value:function(){var e,t=(null===(e=this.gameState)||void 0===e?void 0:e.maxScore)||0;this.gameState=new De,this.gameState.maxScore=t,this.isGameBlocked=!1,this.selectedCell=null,this.selectedCharacter=null,this.attackArea=[],this.moveArea=[],this.createTeams(),this.positionTeams();var n=I(1);this.gamePlay.drawUi(n),this.redraw(),this.gamePlay.showMessage("  !  : ".concat(t))}},{key:"saveGame",value:function(){try{this.updateGameState(),this.stateService.save(this.gameState.toJSON()),this.gamePlay.showMessage(" !")}catch(e){this.gamePlay.showError("  !")}}},{key:"loadGame",value:function(){try{var e=this.stateService.load();e&&(this.gameState=De.from(e),this.restoreGameState(),this.gamePlay.showMessage(" !"))}catch(e){this.gamePlay.showError("  !")}}},{key:"restoreGameState",value:function(){this.playerPositions=this.gameState.playerPositions,this.enemyPositions=this.gameState.enemyPositions,this.gamePlay.drawUi(this.gameState.currentTheme),this.redraw(),this.deselectCharacter(),this.isGameBlocked=!1,this.playerTeam={characters:this.playerPositions.map(function(e){return e.character})},this.enemyTeam={characters:this.enemyPositions.map(function(e){return e.character})}}},{key:"updateGameState",value:function(){this.gameState.playerPositions=Qe(this.playerPositions),this.gameState.enemyPositions=Qe(this.enemyPositions),this.gameState.currentTheme=I(this.gameState.level)}},{key:"onNewGameClick",value:function(){confirm("  ?    .")&&this.newGame()}},{key:"onSaveGameClick",value:function(){this.saveGame()}},{key:"onLoadGameClick",value:function(){confirm("  ?    .")&&this.loadGame()}},{key:"getPossibleMoves",value:function(e){for(var t,n=[],r=e.position,o=e.character,a=-(t="swordsman"===o.type||"undead"===o.type?4:"bowman"===o.type||"vampire"===o.type?2:1);a<=t;a++)for(var i=-t;i<=t;i++){var c=Math.floor(r/8)+a,l=r%8+i;if(c>=0&&c<8&&l>=0&&l<8){var s=8*c+l;!this.isCellOccupied(s)&&Math.max(Math.abs(a),Math.abs(i))<=t&&n.push(s)}}return n}},{key:"findNearestPlayer",value:function(e){var t=null,n=1/0;return this.playerPositions.forEach(function(r){var o=Math.abs(Math.floor(e.position/8)-Math.floor(r.position/8))+Math.abs(e.position%8-r.position%8);o<n&&(n=o,t=r)}),t}}],n=[{key:"findBestMoveTowardsTarget",value:function(e,t,n){var r=null,o=1/0,a=t.position;return n.forEach(function(e){var t=Math.abs(Math.floor(e/8)-Math.floor(a/8))+Math.abs(e%8-a%8);t<o&&(o=t,r=e)}),r}}],t&&Ke(e.prototype,t),n&&Ke(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function Ze(){console.log("DOM loaded");var e=document.querySelector(".game-container");e||(console.log("Creating game container"),(e=document.createElement("div")).className="game-container",document.body.appendChild(e));try{var t=new L,n=new A(localStorage),r=new Ye(t,n);window.gamePlay=t,window.gameController=r,t.bindToDOM(e),r.init(),console.log("Game initialized successfully")}catch(e){console.error("Failed to initialize game:",e)}}console.log("Retro Game initializing..."),window.gamePlay=null,window.gameController=null,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ze):Ze()})();